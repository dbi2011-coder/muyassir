<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>إدارة المعلمين</title>
    <link rel="stylesheet" href="../css/teacher.css" />
    <style>
        .btn-primary {
            background-color: #1e90ff;
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-radius: 5px;
        }
        #formContainer form label {
            display: block;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
<header>
    <h1>إدارة المعلمين</h1>
    <button class="logout-btn">تسجيل خروج</button>
</header>

<main>
    <table border="1" width="100%" style="margin-top: 20px; border-collapse: collapse; text-align: center;">
        <thead>
            <tr>
                <th>الرقم</th>
                <th>الاسم</th>
                <th>اسم المستخدم</th>
                <th>البريد الإلكتروني</th>
                <th>رقم الهاتف</th>
                <th>إجراءات</th>
            </tr>
        </thead>
        <tbody id="teachersTable"></tbody>
    </table>
</main>

<script src="../js/database.js"></script>
<script src="../js/auth.js"></script>

<script>
    function loadTeachers() {
        const teachersTable = document.getElementById('teachersTable');
        teachersTable.innerHTML = '';
        const users = database.getUsers();
        users.forEach((user, index) => {
            if (user.role === 'teacher') {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${user.name}</td>
                    <td>${user.username}</td>
                    <td>${user.email || ''}</td>
                    <td>${user.phone || ''}</td>
                    <td></td>
                `;
                teachersTable.appendChild(tr);
            }
        });
    }

    function showAddTeacherOption() {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (currentUser && currentUser.username === 'owner' && currentUser.role === 'teacher') {
            const addBtn = document.createElement('button');
            addBtn.textContent = 'إضافة معلم جديد';
            addBtn.classList.add('btn-primary');
            addBtn.style.margin = '1rem 0';
            addBtn.onclick = openAddTeacherForm;
            document.querySelector('main').prepend(addBtn);
        }
    }

    function openAddTeacherForm() {
        const container = document.createElement('div');
        container.id = 'formContainer';
        container.innerHTML = `
            <form id="addTeacherForm" style="padding: 1rem; border: 1px solid #ddd; background: #f9f9f9; max-width: 300px; margin: 1rem auto;">
                <h3>إضافة معلم جديد</h3>
                <label>الاسم: <input type="text" name="name" required></label>
                <label>اسم المستخدم: <input type="text" name="username" required></label>
                <label>كلمة المرور: <input type="password" name="password" required></label>
                <button type="submit" class="btn-primary">حفظ</button>
                <button type="button" id="cancelBtn">إلغاء</button>
            </form>
        `;
        document.body.appendChild(container);

        document.getElementById('addTeacherForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const newTeacher = {
                id: Date.now(),
                name: formData.get('name').trim(),
                username: formData.get('username').trim(),
                password: formData.get('password'),
                role: 'teacher',
                email: '',
                phone: ''
            };
            const users = database.getUsers();

            if (users.some(u => u.username === newTeacher.username)) {
                alert('اسم المستخدم موجود مسبقًا!');
                return;
            }

            users.push(newTeacher);
            localStorage.setItem('muyassir_users', JSON.stringify(users));
            alert('تم إضافة المعلم بنجاح');
            container.remove();
            loadTeachers();
        });

        document.getElementById('cancelBtn').addEventListener('click', () => {
            container.remove();
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        showAddTeacherOption();
        loadTeachers();
    });
</script>
</body>
</html>
